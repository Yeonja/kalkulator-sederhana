<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Kalkulator Sederhana</title>
    <link rel="stylesheet" href="stlye.css">
</head>
<body>
    <h2>Kalkulator Sederhana</h2>

    <div class="calculator">
        <input type="text" class="calculator-screen" value="0" disabled />

        <div class="calculator-keys">
            <button type="button" class="operator" value="+">+</button>
            <button type="button" class="operator" value="-">-</button>
            <button type="button" class="operator" value="*">&times;</button>
            <button type="button" class="operator" value="/">/</button>
            <button type="button" class="operator" value="^">âˆš</button> <button type="button" value="7">7</button>
            <button type="button" value="8">8</button>
            <button type="button" value="9">9</button>

            <button type="button" value="4">4</button>
            <button type="button" value="5">5</button>
            <button type="button" value="6">6</button>

            <button type="button" value="1">1</button>
            <button type="button" value="2">2</button>
            <button type="button" value="3">3</button>

            <button type="button" value="0">0</button>
            <button type="button" class="decimal" value=".">.</button>
            <button type="button" class="all-clear" value="clear">AC</button>

            <button type="button" class="equal-sign" value="=">=</button>
        </div>
    </div>

    <script>
        const calculator = document.querySelector('.calculator');
        const keys = calculator.querySelector('.calculator-keys');
        const display = calculator.querySelector('.calculator-screen');

        let firstValue = null;
        let operator = null;
        let waitingForSecondValue = false;

        function calculate(n1, operator, n2) {
            const firstNum = parseFloat(n1);
            const secondNum = parseFloat(n2);

            if (operator === '+') {
                return firstNum + secondNum;
            }
            if (operator === '-') {
                return firstNum - secondNum;
            }
            if (operator === '*') {
                return firstNum * secondNum;
            }
            if (operator === '/') {
                return secondNum === 0 ? 'Tidak bisa dibagi 0!' : firstNum / secondNum;
            }
            return n2; // Mengembalikan nilai kedua jika operator tidak ditemukan (kasus akar kuadrat)
        }

        keys.addEventListener('click', event => {
            const { target } = event;
            const { value } = target;

            if (!target.matches('button')) {
                return;
            }

            if (target.classList.contains('operator')) {
                if (value === '^') { // Operator akar kuadrat
                    const currentDisplayValue = parseFloat(display.value);
                    if (currentDisplayValue < 0) {
                        display.value = 'Tidak bisa akar dari bilangan negatif!';
                    } else {
                        display.value = Math.sqrt(currentDisplayValue);
                    }
                    firstValue = null; // Reset
                    operator = null;
                    waitingForSecondValue = false;
                } else {
                    handleOperator(value);
                }
                return;
            }

            if (target.classList.contains('decimal')) {
                inputDecimal(value);
                return;
            }

            if (target.classList.contains('all-clear')) {
                clearCalculator();
                return;
            }

            if (target.classList.contains('equal-sign')) {
                handleEquals();
                return;
            }

            inputDigit(value);
        });

        function inputDigit(digit) {
            const displayValue = display.value;
            if (waitingForSecondValue === true) {
                display.value = digit;
                waitingForSecondValue = false;
            } else {
                display.value = displayValue === '0' ? digit : displayValue + digit;
            }
        }

        function inputDecimal(dot) {
            if (waitingForSecondValue === true) {
                display.value = '0.';
                waitingForSecondValue = false;
                return;
            }
            if (!display.value.includes(dot)) {
                display.value += dot;
            }
        }

        function handleOperator(nextOperator) {
            const displayValue = display.value;
            const value = parseFloat(displayValue);

            if (operator && waitingForSecondValue) {
                operator = nextOperator;
                return;
            }

            if (firstValue === null) {
                firstValue = value;
            } else if (operator) {
                const result = calculate(firstValue, operator, value);
                display.value = String(result);
                firstValue = result;
            }

            waitingForSecondValue = true;
            operator = nextOperator;
        }

        function clearCalculator() {
            display.value = '0';
            firstValue = null;
            operator = null;
            waitingForSecondValue = false;
        }

        function handleEquals() {
            const displayValue = display.value;
            const value = parseFloat(displayValue);

            if (firstValue === null || operator === null || waitingForSecondValue) {
                return; // Tidak ada cukup input untuk dihitung
            }

            const result = calculate(firstValue, operator, value);
            display.value = String(result);
            firstValue = result;
            operator = null; // Reset operator setelah perhitungan
            waitingForSecondValue = false; // Siap untuk input baru
        }
    </script>
</body>
</html>
